<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∏ªË¶ÅË≥áÁî£„ÇØ„É©„Çπ100Âπ¥ÊØîËºÉ„ÉÅ„É£„Éº„Éà (1924-2024)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', 'Helvetica', 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 30px;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
            font-size: 28px;
        }
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 14px;
        }
        .chart-container {
            position: relative;
            height: 500px;
            margin-bottom: 40px;
            transition: height 0.3s ease;
        }
        .chart-container.short-period {
            height: 650px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .stat-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid;
        }
        .stat-card h3 {
            margin: 0 0 10px 0;
            font-size: 16px;
            display: flex;
            align-items: center;
        }
        .stat-card .value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        .stat-card .period {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        .period-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .period-btn {
            padding: 8px 16px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #2c3e50;
            transition: all 0.2s;
        }
        .period-btn:hover {
            border-color: #2c3e50;
            background: #f8f9fa;
        }
        .period-btn.active {
            background: #2c3e50;
            color: white;
            border-color: #2c3e50;
        }
        .legend-box {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            margin: 0;
        }
        .legend-item label {
            margin: 0;
        }
        .legend-color {
            width: 20px;
            height: 3px;
        }
        .notes {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-top: 30px;
            border-radius: 4px;
        }
        .notes h4 {
            margin: 0 0 10px 0;
            color: #856404;
        }
        .notes ul {
            margin: 5px 0;
            padding-left: 20px;
        }
        .notes li {
            margin: 5px 0;
            color: #856404;
            font-size: 14px;
        }
        .table-container {
            overflow-x: auto;
            margin-top: 30px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        th, td {
            padding: 10px;
            text-align: right;
            border: 1px solid #dee2e6;
        }
        th {
            background: #f8f9fa;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        th:first-child, td:first-child {
            text-align: left;
            position: sticky;
            left: 0;
            background: white;
            z-index: 1;
        }
        th:first-child {
            background: #f8f9fa;
            z-index: 2;
        }
        tr:hover {
            background: #f8f9fa;
        }
        .positive {
            color: #28a745;
        }
        .negative {
            color: #dc3545;
        }
        .rank-1, .rank-2, .rank-3 {
            position: relative;
            font-weight: bold;
            padding-top: 22px !important;
        }
        .rank-1::before {
            content: '‰∏Ä‰Ωç';
            position: absolute;
            top: 4px;
            left: 10px;
            font-size: 0.75em;
            color: #d4af37;
            font-weight: bold;
        }
        .rank-2::before {
            content: '‰∫å‰Ωç';
            position: absolute;
            top: 4px;
            left: 10px;
            font-size: 0.75em;
            color: #c0c0c0;
            font-weight: bold;
        }
        .rank-3::before {
            content: '‰∏â‰Ωç';
            position: absolute;
            top: 4px;
            left: 10px;
            font-size: 0.75em;
            color: #cd7f32;
            font-weight: bold;
        }

        /* „Éá„Çπ„ÇØ„Éà„ÉÉ„ÉóÁâà„Åß„ÅØ„Éá„Éï„Ç©„É´„Éà„ÅÆÈ†ÜÂ∫è */
        @media (min-width: 769px) {
            .chart-wrapper {
                display: block;
            }

            .legend-box {
                order: 0;
                margin-bottom: 20px;
                margin-top: 0;
            }

            .chart-container {
                order: 0;
                margin-bottom: 20px;
            }
        }

        /* „Çπ„Éû„ÉõÂØæÂøú„É¨„Çπ„Éù„É≥„Ç∑„Éñ„Éá„Ç∂„Ç§„É≥ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 15px;
                border-radius: 8px;
            }

            h1 {
                font-size: 20px;
                margin-bottom: 8px;
            }

            .subtitle {
                font-size: 12px;
                margin-bottom: 20px;
            }

            .period-selector {
                gap: 6px;
                margin-bottom: 12px;
            }

            .period-btn {
                padding: 6px 12px;
                font-size: 12px;
            }

            .legend-box {
                gap: 10px;
            }

            .legend-item {
                flex: 0 0 calc(50% - 5px);
                font-size: 13px;
            }

            .legend-item label span {
                font-size: 12px;
            }

            /* „ÉÅ„É£„Éº„Éà„É©„ÉÉ„Éë„Éº„Çí„Éï„É¨„ÉÉ„ÇØ„Çπ„Ç≥„É≥„ÉÜ„Éä„Å´„Åó„Å¶È†ÜÂ∫è„ÇíÂà∂Âæ° */
            .chart-wrapper {
                display: flex;
                flex-direction: column;
            }

            .legend-box {
                order: 2; /* „Çπ„Éû„Éõ„Åß„ÅØÂá°‰æã„Çí‰∏ã„Å´ */
                margin-top: 15px;
                margin-bottom: 0;
            }

            .chart-container {
                order: 1; /* „Çπ„Éû„Éõ„Åß„ÅØ„ÉÅ„É£„Éº„Éà„Çí‰∏ä„Å´ */
                height: 300px;
                margin-bottom: 0;
            }

            .chart-container.short-period {
                height: 400px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
                margin-top: 20px;
            }

            .stat-card {
                padding: 12px;
            }

            .stat-card h3 {
                font-size: 14px;
            }

            .stat-card .value {
                font-size: 20px;
            }

            .stat-card .period {
                font-size: 11px;
            }

            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            table {
                font-size: 11px;
                min-width: 650px;
            }

            th, td {
                padding: 6px 4px;
            }

            /* „É©„É≥„Ç≠„É≥„Ç∞Ë°®Á§∫„ÅÆË™øÊï¥ */
            .rank-1::before, .rank-2::before, .rank-3::before {
                font-size: 0.6em !important;
                top: 2px !important;
                left: 2px !important;
            }

            .rank-1, .rank-2, .rank-3 {
                padding-top: 16px !important;
            }

            /* ÊúüÈñìÂàó„ÅÆË™øÊï¥ */
            td:first-child {
                font-size: 10px;
                min-width: 60px;
            }

            td:first-child small {
                font-size: 9px;
                display: block;
            }

            /* „ÉÜ„Éº„Éñ„É´Ë¶ãÂá∫„Åó„ÅÆ„Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫ */
            table h3 {
                font-size: 16px !important;
            }

            .notes {
                padding: 12px;
                font-size: 12px;
            }

            .notes h4 {
                font-size: 14px;
            }

            .notes li {
                font-size: 12px;
            }

            /* „Ç∑„Éü„É•„É¨„Éº„Çø„ÉºË™øÊï¥ */
            [style*="margin-top: 40px"] {
                margin-top: 20px !important;
                padding: 15px !important;
            }

            [style*="padding: 25px"] {
                padding: 15px !important;
            }

            h2 {
                font-size: 18px !important;
            }

            #simStartYear, #simEndYear, #assetSelect {
                font-size: 13px !important;
                padding: 8px !important;
            }

            /* ÈäòÊüÑÈÅ∏Êäû„É©„Éô„É´„ÅÆ„Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫ */
            label[style*="üìä Ë≥áÁî£„ÇíÈÅ∏Êäû"] {
                font-size: 13px !important;
            }

            /* Âπ¥ÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„ÅÆ„Ç≥„É≥„ÉÜ„Éä */
            [style*="display: flex; gap: 20px"] {
                gap: 10px !important;
            }

            /* „É©„Éô„É´„ÅÆ„Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫Ë™øÊï¥ */
            [style*="font-weight: 600"] {
                font-size: 13px !important;
                margin-bottom: 8px !important;
            }

            button[onclick="runSimulation()"] {
                font-size: 16px !important;
                padding: 12px !important;
            }

            /* „Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥ÁµêÊûú„ÅÆ„Ç∞„É™„ÉÉ„ÉâË™øÊï¥ */
            #simulationResult [style*="grid-template-columns"] {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 10px !important;
            }

            #simulationResult [style*="font-size: 24px"] {
                font-size: 18px !important;
            }

            #simulationResult [style*="font-size: 14px"] {
                font-size: 12px !important;
            }
        }

        /* Ê•µÂ∞è„Çπ„Éû„ÉõÂØæÂøú */
        @media (max-width: 480px) {
            h1 {
                font-size: 18px;
            }

            .legend-item {
                flex: 0 0 100%;
            }

            .chart-container {
                height: 250px;
            }

            .stat-card .value {
                font-size: 18px;
            }

            table {
                font-size: 10px;
                min-width: 580px;
            }

            th, td {
                padding: 5px 3px;
            }

            /* Ê•µÂ∞èÁîªÈù¢„Åß„ÅÆ„É©„É≥„Ç≠„É≥„Ç∞Ë™øÊï¥ */
            .rank-1::before, .rank-2::before, .rank-3::before {
                font-size: 0.55em !important;
                top: 1px !important;
                left: 1px !important;
            }

            .rank-1, .rank-2, .rank-3 {
                padding-top: 14px !important;
            }

            td:first-child {
                font-size: 9px;
                min-width: 55px;
            }

            td:first-child small {
                font-size: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåç ‰∏ªË¶ÅË≥áÁî£ „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊØîËºÉ</h1>

        <div class="period-selector">
            <button class="period-btn active" onclick="changePeriod(100)">100Âπ¥</button>
            <button class="period-btn" onclick="changePeriod(50)">50Âπ¥</button>
            <button class="period-btn" onclick="changePeriod(20)">20Âπ¥</button>
            <button class="period-btn" onclick="changePeriod(10)">10Âπ¥</button>
            <button class="period-btn" onclick="changePeriod(5)">5Âπ¥</button>
            <button class="period-btn" onclick="changePeriod(1)">1Âπ¥</button>
        </div>

        <div class="chart-wrapper">
        <div class="legend-box">
            <div class="legend-item">
                <input type="checkbox" id="chart-sp500" value="sp500" checked onchange="updateChart()">
                <label for="chart-sp500" style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                    <div class="legend-color" style="background: #FF6384;"></div>
                    <span>S&P 500ÔºàÁ±≥ÂõΩÊ†™ÂºèÔºâ</span>
                </label>
            </div>
            <div class="legend-item">
                <input type="checkbox" id="chart-gold" value="gold" checked onchange="updateChart()">
                <label for="chart-gold" style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                    <div class="legend-color" style="background: #FFD700;"></div>
                    <span>ÈáëÔºà„Ç¥„Éº„É´„ÉâÔºâ</span>
                </label>
            </div>
            <div class="legend-item">
                <input type="checkbox" id="chart-bonds" value="bonds" onchange="updateChart()">
                <label for="chart-bonds" style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                    <div class="legend-color" style="background: #36A2EB;"></div>
                    <span>Á±≥ÂõΩ10Âπ¥ÂÇµ</span>
                </label>
            </div>
            <div class="legend-item">
                <input type="checkbox" id="chart-nikkei" value="nikkei" onchange="updateChart()">
                <label for="chart-nikkei" style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                    <div class="legend-color" style="background: #4BC0C0;"></div>
                    <span>Êó•ÁµåÂπ≥ÂùáÊ†™‰æ°</span>
                </label>
            </div>
            <div class="legend-item">
                <input type="checkbox" id="chart-dollar" value="dollar" onchange="updateChart()">
                <label for="chart-dollar" style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                    <div class="legend-color" style="background: #9966FF;"></div>
                    <span>Á±≥„Éâ„É´ÊåáÊï∞</span>
                </label>
            </div>
            <div class="legend-item">
                <input type="checkbox" id="chart-nasdaq" value="nasdaq" onchange="updateChart()">
                <label for="chart-nasdaq" style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                    <div class="legend-color" style="background: #FF9F40;"></div>
                    <span>NASDAQ 100</span>
                </label>
            </div>
            <div class="legend-item">
                <input type="checkbox" id="chart-bitcoin" value="bitcoin" onchange="updateChart()">
                <label for="chart-bitcoin" style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                    <div class="legend-color" style="background: #F7931A;"></div>
                    <span>„Éì„ÉÉ„Éà„Ç≥„Ç§„É≥</span>
                </label>
            </div>
            <div class="legend-item">
                <input type="checkbox" id="chart-jpy" value="jpy" checked onchange="updateChart()">
                <label for="chart-jpy" style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                    <div class="legend-color" style="background: #E91E63;"></div>
                    <span>Êó•Êú¨ÂÜÜ</span>
                </label>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="mainChart"></canvas>
        </div>
        </div>

        <!-- Investment Simulator Section -->
        <div style="margin-top: 40px; padding: 30px; background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 12px;">
            <h2 style="color: #2c3e50; text-align: center; margin-bottom: 30px;">üí∞ 100‰∏áÂÜÜÊäïË≥á„Ç∑„Éü„É•„É¨„Éº„Çø„Éº</h2>

            <div style="background: white; border-radius: 10px; padding: 25px; border: 1px solid #e0e0e0;">
                <div style="margin-bottom: 20px;">
                    <label style="font-weight: 600; color: #2c3e50; display: block; margin-bottom: 10px;">üìä Ë≥áÁî£„ÇíÈÅ∏Êäû</label>
                    <select id="assetSelect" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px;">
                        <option value="sp500">S&P 500ÔºàÁ±≥ÂõΩÊ†™Ôºâ</option>
                        <option value="gold">ÈáëÔºà„Ç¥„Éº„É´„ÉâÔºâ</option>
                        <option value="bonds">Á±≥10Âπ¥ÂÇµ</option>
                        <option value="nikkei">Êó•ÁµåÂπ≥Âùá</option>
                        <option value="dollar">Á±≥„Éâ„É´ÊåáÊï∞</option>
                        <option value="nasdaq">NASDAQ 100</option>
                        <option value="bitcoin">„Éì„ÉÉ„Éà„Ç≥„Ç§„É≥</option>
                        <option value="jpy">Êó•Êú¨ÂÜÜ</option>
                    </select>
                </div>

                <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                    <div style="flex: 1;">
                        <label style="font-weight: 600; color: #2c3e50; display: block; margin-bottom: 10px;">ÈñãÂßãÂπ¥</label>
                        <input type="number" id="simStartYear" min="1924" max="2050" value="2024" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px;">
                    </div>
                    <div style="flex: 1;">
                        <label style="font-weight: 600; color: #2c3e50; display: block; margin-bottom: 10px;">ÁµÇ‰∫ÜÂπ¥</label>
                        <input type="number" id="simEndYear" min="1924" max="2050" value="2050" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px;">
                    </div>
                </div>

                <button onclick="runSimulation()" style="width: 100%; padding: 15px; background: #2c3e50; color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: 600; cursor: pointer; transition: background 0.3s;" onmouseover="this.style.background='#1a252f'" onmouseout="this.style.background='#2c3e50'">
                    „Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥ÂÆüË°å
                </button>

                <div id="simulationResult" style="display: none; margin-top: 25px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                    <h3 id="resultTitle" style="color: #2c3e50; margin-bottom: 15px;"></h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div>
                            <div style="color: #6c757d; font-size: 14px;">ÊäïË≥áÂÖÉÊú¨</div>
                            <div style="color: #2c3e50; font-size: 24px; font-weight: bold;">¬•1,000,000</div>
                        </div>
                        <div>
                            <div style="color: #6c757d; font-size: 14px;">ÊúÄÁµÇ‰æ°ÂÄ§</div>
                            <div id="finalValue" style="color: #2c3e50; font-size: 24px; font-weight: bold;"></div>
                        </div>
                        <div>
                            <div style="color: #6c757d; font-size: 14px;">Á∑è„É™„Çø„Éº„É≥</div>
                            <div id="totalReturn" style="font-size: 24px; font-weight: bold;"></div>
                        </div>
                        <div>
                            <div style="color: #6c757d; font-size: 14px;">Âπ¥Áéá„É™„Çø„Éº„É≥</div>
                            <div id="annualReturn" style="font-size: 24px; font-weight: bold;"></div>
                        </div>
                    </div>
                    <div style="position: relative; height: 300px; margin-top: 20px;">
                        <canvas id="simChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card" style="border-color: #FF6384;">
                <h3>üìà S&P 500</h3>
                <div class="value">Âπ¥Âπ≥Âùá: 10.68%</div>
                <div class="period">100Âπ¥ÈñìÁ∑è„É™„Çø„Éº„É≥: +2,984,809%</div>
            </div>
            <div class="stat-card" style="border-color: #FFD700;">
                <h3>üèÜ ÈáëÔºà„Ç¥„Éº„É´„ÉâÔºâ</h3>
                <div class="value">Âπ¥Âπ≥Âùá: 4.88%</div>
                <div class="period">100Âπ¥ÈñìÁ∑è„É™„Çø„Éº„É≥: +11,454%</div>
            </div>
            <div class="stat-card" style="border-color: #36A2EB;">
                <h3>üìä Á±≥ÂõΩ10Âπ¥ÂÇµ</h3>
                <div class="value">Âπ¥Âπ≥Âùá: 4.33%</div>
                <div class="period">100Âπ¥ÈñìÁ∑è„É™„Çø„Éº„É≥: +7,100%</div>
            </div>
            <div class="stat-card" style="border-color: #4BC0C0;">
                <h3>üóæ Êó•ÁµåÂπ≥Âùá</h3>
                <div class="value">Âπ¥Âπ≥Âùá: 7.35%</div>
                <div class="period">75Âπ¥ÈñìÁ∑è„É™„Çø„Éº„É≥: +22,532%Ôºà1949-2024Ôºâ</div>
            </div>
            <div class="stat-card" style="border-color: #9966FF;">
                <h3>üíµ Á±≥„Éâ„É´ÊåáÊï∞</h3>
                <div class="value">Âπ¥Âπ≥Âùá: -0.06%</div>
                <div class="period">51Âπ¥ÈñìÂ§âÂãï: -3%Ôºà1973-2024Ôºâ</div>
            </div>
            <div class="stat-card" style="border-color: #FF9F40;">
                <h3>üíª NASDAQ 100</h3>
                <div class="value">Âπ¥Âπ≥Âùá: 14.4%</div>
                <div class="period">39Âπ¥ÈñìÁ∑è„É™„Çø„Éº„É≥: +24,950%Ôºà1985-2024Ôºâ</div>
            </div>
            <div class="stat-card" style="border-color: #F7931A;">
                <h3>‚Çø „Éì„ÉÉ„Éà„Ç≥„Ç§„É≥</h3>
                <div class="value">Âπ¥Âπ≥Âùá: 230%</div>
                <div class="period">14Âπ¥ÈñìÁ∑è„É™„Çø„Éº„É≥: +9,400,000%Ôºà2010-2024Ôºâ</div>
            </div>
            <div class="stat-card" style="border-color: #E91E63;">
                <h3>üí¥ Êó•Êú¨ÂÜÜ</h3>
                <div class="value">Âπ¥Âπ≥Âùá: -0.53%</div>
                <div class="period">75Âπ¥ÈñìÂ§âÂãï: -33%Ôºà1949-2024Ôºâ</div>
            </div>
        </div>

        <div class="table-container">
            <h3 style="margin-top: 30px;">‰∏ªË¶ÅÊúüÈñìÂà•„É™„Çø„Éº„É≥ÊØîËºÉË°®</h3>
            <table>
                <thead>
                    <tr>
                        <th>ÊúüÈñì</th>
                        <th>S&P 500</th>
                        <th>Èáë</th>
                        <th>Á±≥ÂõΩ10Âπ¥ÂÇµ</th>
                        <th>Êó•ÁµåÂπ≥Âùá</th>
                        <th>Á±≥„Éâ„É´ÊåáÊï∞</th>
                        <th>NASDAQ 100</th>
                        <th>„Éì„ÉÉ„Éà„Ç≥„Ç§„É≥</th>
                        <th>Êó•Êú¨ÂÜÜ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>1920Âπ¥‰ª£</strong><br><small>Â•ΩÊôØÊ∞óÊôÇ‰ª£</small></td>
                        <td class="positive rank-1">+265%</td>
                        <td class="negative">-3%</td>
                        <td class="positive rank-2">+45%</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td><strong>1930Âπ¥‰ª£</strong><br><small>Â§ßÊÅêÊÖå</small></td>
                        <td class="negative">-41%</td>
                        <td class="positive rank-1">+69%</td>
                        <td class="positive rank-2">+40%</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td><strong>1940Âπ¥‰ª£</strong><br><small>Á¨¨‰∫åÊ¨°‰∏ñÁïåÂ§ßÊà¶</small></td>
                        <td class="positive rank-1">+35%</td>
                        <td class="negative">-1%</td>
                        <td class="positive rank-2">+33%</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td><strong>1950Âπ¥‰ª£</strong><br><small>Êà¶ÂæåÂæ©Ëàà</small></td>
                        <td class="positive rank-2">+257%</td>
                        <td class="negative">-3%</td>
                        <td class="negative">-4%</td>
                        <td class="positive rank-1">+380%</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                        <td class="negative">-1%</td>
                    </tr>
                    <tr>
                        <td><strong>1960Âπ¥‰ª£</strong><br><small>È´òÂ∫¶ÊàêÈï∑Êúü</small></td>
                        <td class="positive rank-2">+54%</td>
                        <td class="positive">+11%</td>
                        <td class="positive rank-3">+15%</td>
                        <td class="positive rank-1">+105%</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                        <td class="negative">-2%</td>
                    </tr>
                    <tr>
                        <td><strong>1970Âπ¥‰ª£</strong><br><small>„Ç™„Ç§„É´„Ç∑„Éß„ÉÉ„ÇØ</small></td>
                        <td class="positive">+17%</td>
                        <td class="positive rank-1">+1,365%</td>
                        <td class="positive rank-3">+51%</td>
                        <td class="positive rank-2">+190%</td>
                        <td class="negative">-23%</td>
                        <td>-</td>
                        <td>-</td>
                        <td class="positive">+28%</td>
                    </tr>
                    <tr>
                        <td><strong>1980Âπ¥‰ª£</strong><br><small>„Éê„Éñ„É´ÁµåÊ∏à</small></td>
                        <td class="positive rank-2">+228%</td>
                        <td class="positive">+22%</td>
                        <td class="positive rank-3">+176%</td>
                        <td class="positive rank-1">+430%</td>
                        <td class="positive">+67%</td>
                        <td class="positive">+117%</td>
                        <td>-</td>
                        <td class="negative">-46%</td>
                    </tr>
                    <tr>
                        <td><strong>1990Âπ¥‰ª£</strong><br><small>IT„Éê„Éñ„É´</small></td>
                        <td class="positive rank-2">+315%</td>
                        <td class="negative">-29%</td>
                        <td class="positive rank-3">+95%</td>
                        <td class="negative">-40%</td>
                        <td class="positive">+25%</td>
                        <td class="positive rank-1">+795%</td>
                        <td>-</td>
                        <td class="positive">+15%</td>
                    </tr>
                    <tr>
                        <td><strong>2000Âπ¥‰ª£</strong><br><small>ÈáëËûçÂç±Ê©ü</small></td>
                        <td class="negative">-24%</td>
                        <td class="positive rank-1">+280%</td>
                        <td class="positive rank-2">+84%</td>
                        <td class="negative">-42%</td>
                        <td class="negative rank-3">-23%</td>
                        <td class="negative">-42%</td>
                        <td>-</td>
                        <td class="positive">+11%</td>
                    </tr>
                    <tr>
                        <td><strong>2010Âπ¥‰ª£</strong><br><small>ÈáèÁöÑÁ∑©Âíå</small></td>
                        <td class="positive rank-3">+190%</td>
                        <td class="positive">+24%</td>
                        <td class="positive">+45%</td>
                        <td class="positive">+173%</td>
                        <td class="positive">+25%</td>
                        <td class="positive rank-2">+430%</td>
                        <td class="positive rank-1">+137,900%</td>
                        <td class="negative">-6%</td>
                    </tr>
                    <tr>
                        <td><strong>2020-2024</strong><br><small>„Ç≥„É≠„Éä„Éª„Ç§„É≥„Éï„É¨</small></td>
                        <td class="positive">+53%</td>
                        <td class="positive">+52%</td>
                        <td class="negative">-8%</td>
                        <td class="positive rank-3">+65%</td>
                        <td class="positive">+15%</td>
                        <td class="positive rank-2">+108%</td>
                        <td class="positive rank-1">+224%</td>
                        <td class="negative">-27%</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // „ÉÅ„É£„Éº„Éà„Éá„Éº„Çø„ÅÆÊ∫ñÂÇô
        const years = [];
        const sp500Data = [];
        const goldData = [];
        const bondsData = [];
        const nikkeiData = [];
        const dollarData = [];

        // ‰ª£Ë°®ÁöÑ„Å™Âπ¥„ÅÆ„Éá„Éº„Çø„Éù„Ç§„É≥„ÉàÔºàÂØæÊï∞„Çπ„Ç±„Éº„É´Áî®Ôºâ
        const dataPoints = [
            { year: 1924, sp500: 100, gold: 100, bonds: 100, nikkei: null, dollar: null, nasdaq: null, bitcoin: null, jpy: null },
            { year: 1929, sp500: 365, gold: 97, bonds: 145, nikkei: null, dollar: null, nasdaq: null, bitcoin: null, jpy: null },
            { year: 1932, sp500: 89, gold: 120, bonds: 180, nikkei: null, dollar: null, nasdaq: null, bitcoin: null, jpy: null },
            { year: 1940, sp500: 216, gold: 164, bonds: 203, nikkei: null, dollar: null, nasdaq: null, bitcoin: null, jpy: null },
            { year: 1949, sp500: 292, gold: 162, bonds: 270, nikkei: 100, dollar: null, nasdaq: null, bitcoin: null, jpy: 100 },
            { year: 1950, sp500: 353, gold: 162, bonds: 268, nikkei: 102, dollar: null, nasdaq: null, bitcoin: null, jpy: 100 },
            { year: 1960, sp500: 1260, gold: 158, bonds: 258, nikkei: 490, dollar: null, nasdaq: null, bitcoin: null, jpy: 99 },
            { year: 1970, sp500: 1940, gold: 175, bonds: 297, nikkei: 1004, dollar: null, nasdaq: null, bitcoin: null, jpy: 97 },
            { year: 1973, sp500: 2265, gold: 470, bonds: 320, nikkei: 2900, dollar: 100, nasdaq: null, bitcoin: null, jpy: 124 },
            { year: 1980, sp500: 2650, gold: 2977, bonds: 448, nikkei: 3860, dollar: 77, nasdaq: null, bitcoin: null, jpy: 151 },
            { year: 1985, sp500: 5150, gold: 1536, bonds: 895, nikkei: 8300, dollar: 125, nasdaq: 100, bitcoin: null, jpy: 82 },
            { year: 1989, sp500: 6867, gold: 1925, bonds: 1100, nikkei: 20500, dollar: 105, nasdaq: 217, bitcoin: null, jpy: 98 },
            { year: 1990, sp500: 8687, gold: 1772, bonds: 1237, nikkei: 16600, dollar: 128, nasdaq: 202, bitcoin: null, jpy: 79 },
            { year: 1999, sp500: 27500, gold: 1258, bonds: 2200, nikkei: 11000, dollar: 153, nasdaq: 1950, bitcoin: null, jpy: 91 },
            { year: 2000, sp500: 36000, gold: 1258, bonds: 2413, nikkei: 9900, dollar: 160, nasdaq: 1250, bitcoin: null, jpy: 95 },
            { year: 2005, sp500: 31200, gold: 2100, bonds: 3200, nikkei: 8100, dollar: 145, nasdaq: 920, bitcoin: null, jpy: 98 },
            { year: 2008, sp500: 22150, gold: 4250, bonds: 3650, nikkei: 4300, dollar: 110, nasdaq: 729, bitcoin: null, jpy: 105 },
            { year: 2010, sp500: 27350, gold: 5790, bonds: 4443, nikkei: 5740, dollar: 123, nasdaq: 1100, bitcoin: 100, jpy: 110 },
            { year: 2011, sp500: 28100, gold: 7250, bonds: 4820, nikkei: 4850, dollar: 124, nasdaq: 1130, bitcoin: 1500, jpy: 116 },
            { year: 2012, sp500: 33200, gold: 7900, bonds: 5050, nikkei: 5450, dollar: 123, nasdaq: 1335, bitcoin: 2800, jpy: 133 },
            { year: 2013, sp500: 47500, gold: 5780, bonds: 4830, nikkei: 8500, dollar: 123, nasdaq: 1800, bitcoin: 83000, jpy: 103 },
            { year: 2014, sp500: 53300, gold: 5600, bonds: 5350, nikkei: 9750, dollar: 138, nasdaq: 2150, bitcoin: 35000, jpy: 91 },
            { year: 2015, sp500: 54100, gold: 5010, bonds: 5760, nikkei: 10350, dollar: 150, nasdaq: 2360, bitcoin: 47200, jpy: 83 },
            { year: 2016, sp500: 58500, gold: 5580, bonds: 5680, nikkei: 9250, dollar: 155, nasdaq: 2530, bitcoin: 106200, jpy: 85 },
            { year: 2017, sp500: 62000, gold: 6530, bonds: 4930, nikkei: 10200, dollar: 111, nasdaq: 2400, bitcoin: 1380000, jpy: 91 },
            { year: 2018, sp500: 62100, gold: 6010, bonds: 4650, nikkei: 9850, dollar: 115, nasdaq: 2400, bitcoin: 371000, jpy: 94 },
            { year: 2019, sp500: 79400, gold: 7380, bonds: 5990, nikkei: 11550, dollar: 117, nasdaq: 3330, bitcoin: 724000, jpy: 95 },
            { year: 2020, sp500: 79500, gold: 7180, bonds: 6443, nikkei: 15700, dollar: 123, nasdaq: 5830, bitcoin: 2900000, jpy: 96 },
            { year: 2021, sp500: 102500, gold: 6890, bonds: 6123, nikkei: 16500, dollar: 130, nasdaq: 7460, bitcoin: 5800000, jpy: 92 },
            { year: 2022, sp500: 82400, gold: 7420, bonds: 5460, nikkei: 14950, dollar: 140, nasdaq: 5080, bitcoin: 2080000, jpy: 74 },
            { year: 2023, sp500: 118600, gold: 8580, bonds: 5890, nikkei: 18900, dollar: 137, nasdaq: 7870, bitcoin: 5310000, jpy: 69 },
            { year: 2024, sp500: 156900, gold: 11554, bonds: 7200, nikkei: 22632, dollar: 97, nasdaq: 25050, bitcoin: 9400000, jpy: 67 }
        ];

        // All datasets definition
        const allDatasets = {
            sp500: {
                label: 'S&P 500',
                data: dataPoints.map(d => d.sp500),
                borderColor: '#FF6384',
                backgroundColor: 'rgba(255, 99, 132, 0.05)',
                borderWidth: 2.5,
                tension: 0.4,
                pointRadius: 4,
                pointHoverRadius: 6,
                pointBackgroundColor: '#FF6384',
                pointBorderColor: '#fff',
                pointBorderWidth: 1,
                pointHoverBackgroundColor: '#FF6384',
                pointHoverBorderColor: '#fff',
                pointHoverBorderWidth: 2
            },
            gold: {
                label: 'Èáë',
                data: dataPoints.map(d => d.gold),
                borderColor: '#FFD700',
                backgroundColor: 'rgba(255, 215, 0, 0.05)',
                borderWidth: 2.5,
                tension: 0.4,
                pointRadius: 4,
                pointHoverRadius: 6,
                pointBackgroundColor: '#FFD700',
                pointBorderColor: '#fff',
                pointBorderWidth: 1,
                pointHoverBackgroundColor: '#FFD700',
                pointHoverBorderColor: '#fff',
                pointHoverBorderWidth: 2
            },
            bonds: {
                label: 'Á±≥ÂõΩ10Âπ¥ÂÇµ',
                data: dataPoints.map(d => d.bonds),
                borderColor: '#36A2EB',
                backgroundColor: 'rgba(54, 162, 235, 0.05)',
                borderWidth: 2.5,
                tension: 0.4,
                pointRadius: 4,
                pointHoverRadius: 6,
                pointBackgroundColor: '#36A2EB',
                pointBorderColor: '#fff',
                pointBorderWidth: 1,
                pointHoverBackgroundColor: '#36A2EB',
                pointHoverBorderColor: '#fff',
                pointHoverBorderWidth: 2
            },
            nikkei: {
                label: 'Êó•ÁµåÂπ≥Âùá',
                data: dataPoints.map(d => d.nikkei),
                borderColor: '#4BC0C0',
                backgroundColor: 'rgba(75, 192, 192, 0.05)',
                borderWidth: 2.5,
                tension: 0.4,
                pointRadius: 4,
                pointHoverRadius: 6,
                pointBackgroundColor: '#4BC0C0',
                pointBorderColor: '#fff',
                pointBorderWidth: 1,
                pointHoverBackgroundColor: '#4BC0C0',
                pointHoverBorderColor: '#fff',
                pointHoverBorderWidth: 2,
                spanGaps: true
            },
            dollar: {
                label: 'Á±≥„Éâ„É´ÊåáÊï∞',
                data: dataPoints.map(d => d.dollar),
                borderColor: '#9966FF',
                backgroundColor: 'rgba(153, 102, 255, 0.05)',
                borderWidth: 2.5,
                tension: 0.4,
                pointRadius: 4,
                pointHoverRadius: 6,
                pointBackgroundColor: '#9966FF',
                pointBorderColor: '#fff',
                pointBorderWidth: 1,
                pointHoverBackgroundColor: '#9966FF',
                pointHoverBorderColor: '#fff',
                pointHoverBorderWidth: 2,
                spanGaps: true
            },
            nasdaq: {
                label: 'NASDAQ 100',
                data: dataPoints.map(d => d.nasdaq),
                borderColor: '#FF9F40',
                backgroundColor: 'rgba(255, 159, 64, 0.05)',
                borderWidth: 2.5,
                tension: 0.4,
                pointRadius: 4,
                pointHoverRadius: 6,
                pointBackgroundColor: '#FF9F40',
                pointBorderColor: '#fff',
                pointBorderWidth: 1,
                pointHoverBackgroundColor: '#FF9F40',
                pointHoverBorderColor: '#fff',
                pointHoverBorderWidth: 2,
                spanGaps: true
            },
            bitcoin: {
                label: '„Éì„ÉÉ„Éà„Ç≥„Ç§„É≥',
                data: dataPoints.map(d => d.bitcoin),
                borderColor: '#F7931A',
                backgroundColor: 'rgba(247, 147, 26, 0.05)',
                borderWidth: 2.5,
                tension: 0.4,
                pointRadius: 4,
                pointHoverRadius: 6,
                pointBackgroundColor: '#F7931A',
                pointBorderColor: '#fff',
                pointBorderWidth: 1,
                pointHoverBackgroundColor: '#F7931A',
                pointHoverBorderColor: '#fff',
                pointHoverBorderWidth: 2,
                spanGaps: true
            },
            jpy: {
                label: 'Êó•Êú¨ÂÜÜ',
                data: dataPoints.map(d => d.jpy),
                borderColor: '#E91E63',
                backgroundColor: 'rgba(233, 30, 99, 0.05)',
                borderWidth: 2.5,
                tension: 0.4,
                pointRadius: 4,
                pointHoverRadius: 6,
                pointBackgroundColor: '#E91E63',
                pointBorderColor: '#fff',
                pointBorderWidth: 1,
                pointHoverBackgroundColor: '#E91E63',
                pointHoverBorderColor: '#fff',
                pointHoverBorderWidth: 2,
                spanGaps: true
            }
        };

        // „ÉÅ„É£„Éº„Éà„ÅÆÂàùÊúü‰ΩúÊàê
        let mainChart;

        // Âü∫Ê∫ñÁ∑ö„ÇíÊèèÁîª„Åô„Çã„Ç´„Çπ„Çø„É†„Éó„É©„Ç∞„Ç§„É≥
        const baselinePlugin = {
            id: 'baselinePlugin',
            afterDatasetsDraw: function(chart) {
                const ctx = chart.ctx;
                const yScale = chart.scales.y;
                const xScale = chart.scales.x;

                // ¬•100‰∏áÂÜÜ„ÅÆ‰ΩçÁΩÆ„ÇíÂèñÂæó
                const baselineValue = 1000000;
                const yPos = yScale.getPixelForValue(baselineValue);

                // Âü∫Ê∫ñÁ∑ö„ÅåË°®Á§∫ÁØÑÂõ≤ÂÜÖ„Å´„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„ÅøÊèèÁîª
                if (yPos >= yScale.top && yPos <= yScale.bottom) {
                    ctx.save();
                    ctx.strokeStyle = 'rgba(100, 100, 100, 0.5)';
                    ctx.lineWidth = 2;
                    ctx.setLineDash([8, 4]);
                    ctx.beginPath();
                    ctx.moveTo(xScale.left, yPos);
                    ctx.lineTo(xScale.right, yPos);
                    ctx.stroke();

                    // „É©„Éô„É´„ÇíÊèèÁîª
                    ctx.fillStyle = 'rgba(100, 100, 100, 0.8)';
                    ctx.font = 'bold 11px sans-serif';
                    ctx.textAlign = 'left';
                    ctx.fillText('Âü∫Ê∫ñ: ¬•100‰∏áÂÜÜ', xScale.left + 5, yPos - 5);
                    ctx.restore();
                }
            }
        };

        function initChart() {
            const ctx = document.getElementById('mainChart').getContext('2d');
            mainChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: dataPoints.map(d => d.year),
                datasets: [allDatasets.sp500, allDatasets.gold, allDatasets.jpy]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    mode: 'index',
                    intersect: false
                },
                plugins: {
                    title: {
                        display: false
                    },
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleFont: {
                            size: 13
                        },
                        bodyFont: {
                            size: 12
                        },
                        padding: 10,
                        cornerRadius: 4,
                        displayColors: true,
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    const value = context.parsed.y;
                                    if (value >= 100000000) {
                                        label += '¬•' + (value / 100000000).toFixed(2) + 'ÂÑÑÂÜÜ';
                                    } else if (value >= 10000) {
                                        label += '¬•' + (value / 10000).toFixed(1) + '‰∏áÂÜÜ';
                                    } else if (value >= 1000) {
                                        label += '¬•' + (value / 1000).toFixed(1) + 'ÂçÉÂÜÜ';
                                    } else {
                                        label += '¬•' + value.toFixed(0) + 'ÂÜÜ';
                                    }

                                    // Add percentage growth from ¬•100‰∏áÂÜÜ
                                    const growth = ((value - 1000000) / 1000000 * 100).toFixed(1);
                                    if (growth > 0) {
                                        label += ' (+' + growth + '%)';
                                    } else {
                                        label += ' (' + growth + '%)';
                                    }
                                }
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        display: true,
                        title: {
                            display: true,
                            text: 'Âπ¥',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        grid: {
                            display: false,
                            drawBorder: true
                        },
                        ticks: {
                            autoSkip: true,
                            maxTicksLimit: 15,
                            font: {
                                size: 11
                            }
                        }
                    },
                    y: {
                        type: 'logarithmic',
                        display: true,
                        title: {
                            display: true,
                            text: 'ÊäïË≥á‰æ°ÂÄ§',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        // min and max will be set dynamically
                        ticks: {
                            callback: function(value, index, values) {
                                // Á∑öÂΩ¢„Çπ„Ç±„Éº„É´„ÅÆÂ†¥Âêà„ÅØÂ∏∏„Å´Ë°®Á§∫
                                if (this.type === 'linear') {
                                    if (value >= 100000000) {
                                        return (value / 100000000).toFixed(value % 100000000 === 0 ? 0 : 1) + 'ÂÑÑ';
                                    } else if (value >= 10000) {
                                        return (value / 10000).toFixed(0) + '‰∏á';
                                    } else if (value >= 1000) {
                                        return (value / 1000).toFixed(0) + 'ÂçÉ';
                                    } else {
                                        return value.toFixed(0);
                                    }
                                }

                                // ÂØæÊï∞„Çπ„Ç±„Éº„É´„ÅÆÂ†¥Âêà„ÅØÁâπÂÆö„ÅÆÂÄ§„ÅÆ„ÅøË°®Á§∫
                                const tickValues = [100000, 200000, 500000, 1000000, 2000000, 5000000, 10000000, 20000000, 50000000, 100000000, 200000000, 500000000, 1000000000];
                                if (tickValues.includes(value)) {
                                    if (value >= 100000000) {
                                        return (value / 100000000).toFixed(value % 100000000 === 0 ? 0 : 1) + 'ÂÑÑ';
                                    } else if (value >= 10000) {
                                        return (value / 10000).toFixed(0) + '‰∏á';
                                    } else if (value >= 1000) {
                                        return (value / 1000).toFixed(0) + 'ÂçÉ';
                                    } else {
                                        return value.toFixed(0);
                                    }
                                }
                                return '';
                            },
                            autoSkip: false,
                            maxTicksLimit: 10,
                            font: {
                                size: 11
                            },
                            maxRotation: 0,
                            minRotation: 0
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)',
                            drawBorder: false
                        }
                    }
                }
            },
            plugins: [baselinePlugin]
        });

        // „Çπ„Éû„Éõ„Åß„ÉÅ„É£„Éº„ÉàÂ§ñ„Çø„ÉÉ„ÉóÊôÇ„Å´„ÉÑ„Éº„É´„ÉÅ„ÉÉ„Éó„ÇíÈùûË°®Á§∫
        document.addEventListener('click', function(e) {
            const chartCanvas = document.getElementById('mainChart');
            if (mainChart && chartCanvas && !chartCanvas.contains(e.target)) {
                mainChart.tooltip.setActiveElements([], {x: 0, y: 0});
                mainChart.update();
            }
        });
        }

        // Investment Simulator Data
        const simulatorData = {
            sp500: {
                name: 'S&P 500',
                color: '#FF6384',
                avgReturn: 0.1068, // Âπ¥Âπ≥Âùá10.68%
                annualReturns: {
                    1924: 0.12, 1925: 0.30, 1926: 0.11, 1927: 0.37, 1928: 0.44, 1929: -0.08,
                    1930: -0.25, 1931: -0.43, 1932: -0.08, 1933: 0.50, 1934: -0.02, 1935: 0.48,
                    1936: 0.32, 1937: -0.35, 1938: 0.29, 1939: -0.01, 1940: -0.10, 1941: -0.12,
                    1942: 0.19, 1943: 0.26, 1944: 0.20, 1945: 0.36, 1946: -0.08, 1947: 0.05,
                    1948: 0.05, 1949: 0.18, 1950: 0.30, 1951: 0.24, 1952: 0.18, 1953: -0.01,
                    1954: 0.53, 1955: 0.32, 1956: 0.07, 1957: -0.11, 1958: 0.43, 1959: 0.12,
                    1960: 0.00, 1961: 0.27, 1962: -0.09, 1963: 0.23, 1964: 0.16, 1965: 0.12,
                    1966: -0.10, 1967: 0.24, 1968: 0.11, 1969: -0.08, 1970: 0.04, 1971: 0.14,
                    1972: 0.19, 1973: -0.15, 1974: -0.26, 1975: 0.37, 1976: 0.24, 1977: -0.07,
                    1978: 0.07, 1979: 0.18, 1980: 0.32, 1981: -0.05, 1982: 0.21, 1983: 0.23,
                    1984: 0.06, 1985: 0.32, 1986: 0.18, 1987: 0.05, 1988: 0.17, 1989: 0.32,
                    1990: -0.03, 1991: 0.30, 1992: 0.08, 1993: 0.10, 1994: 0.01, 1995: 0.38,
                    1996: 0.23, 1997: 0.33, 1998: 0.29, 1999: 0.21, 2000: -0.09, 2001: -0.12,
                    2002: -0.22, 2003: 0.29, 2004: 0.11, 2005: 0.05, 2006: 0.16, 2007: 0.05,
                    2008: -0.37, 2009: 0.26, 2010: 0.15, 2011: 0.02, 2012: 0.16, 2013: 0.32,
                    2014: 0.14, 2015: 0.01, 2016: 0.12, 2017: 0.22, 2018: -0.04, 2019: 0.31,
                    2020: 0.18, 2021: 0.29, 2022: -0.18, 2023: 0.26, 2024: 0.23
                }
            },
            gold: {
                name: 'ÈáëÔºà„Ç¥„Éº„É´„ÉâÔºâ',
                color: '#FFD700',
                avgReturn: 0.0488, // Âπ¥Âπ≥Âùá4.88%
                annualReturns: {
                    1924: 0.00, 1925: -0.01, 1926: 0.00, 1927: 0.00, 1928: 0.00, 1929: 0.00,
                    1930: 0.00, 1931: -0.17, 1932: 0.21, 1933: 0.27, 1934: 0.32, 1935: 0.00,
                    1936: 0.00, 1937: 0.00, 1938: 0.00, 1939: 0.00, 1940: 0.00, 1941: 0.00,
                    1942: 0.00, 1943: 0.00, 1944: 0.00, 1945: 0.00, 1946: 0.00, 1947: 0.00,
                    1948: 0.00, 1949: 0.00, 1950: 0.00, 1951: 0.00, 1952: 0.00, 1953: 0.00,
                    1954: 0.00, 1955: 0.00, 1956: 0.00, 1957: 0.00, 1958: 0.00, 1959: 0.00,
                    1960: 0.00, 1961: 0.00, 1962: 0.00, 1963: 0.00, 1964: 0.00, 1965: 0.00,
                    1966: 0.00, 1967: 0.00, 1968: 0.00, 1969: 0.00, 1970: 0.00, 1971: 0.09,
                    1972: 0.45, 1973: 0.73, 1974: 0.64, 1975: 0.04, 1976: -0.22, 1977: 0.19,
                    1978: 0.31, 1979: 0.58, 1980: 1.01, 1981: -0.25, 1982: -0.18, 1983: 0.13,
                    1984: -0.15, 1985: -0.12, 1986: 0.16, 1987: 0.21, 1988: -0.02, 1989: -0.03,
                    1990: -0.08, 1991: -0.10, 1992: -0.05, 1993: 0.18, 1994: -0.02, 1995: 0.01,
                    1996: -0.05, 1997: -0.22, 1998: -0.01, 1999: 0.01, 2000: -0.05, 2001: 0.02,
                    2002: 0.25, 2003: 0.20, 2004: 0.04, 2005: 0.18, 2006: 0.23, 2007: 0.31,
                    2008: 0.04, 2009: 0.24, 2010: 0.30, 2011: 0.10, 2012: 0.07, 2013: -0.28,
                    2014: -0.01, 2015: -0.11, 2016: 0.08, 2017: 0.13, 2018: -0.01, 2019: 0.18,
                    2020: 0.25, 2021: -0.04, 2022: 0.00, 2023: 0.13, 2024: 0.27
                }
            },
            bonds: {
                name: 'Á±≥ÂõΩ10Âπ¥ÂÇµ',
                color: '#36A2EB',
                avgReturn: 0.0433, // Âπ¥Âπ≥Âùá4.33%
                annualReturns: {
                    1924: 0.05, 1925: 0.04, 1926: 0.05, 1927: 0.04, 1928: 0.03, 1929: 0.04,
                    1930: 0.05, 1931: 0.02, 1932: 0.08, 1933: 0.01, 1934: 0.07, 1935: 0.05,
                    1936: 0.05, 1937: 0.01, 1938: 0.04, 1939: 0.04, 1940: 0.05, 1941: 0.00,
                    1942: 0.03, 1943: 0.02, 1944: 0.02, 1945: 0.04, 1946: 0.00, 1947: -0.01,
                    1948: 0.02, 1949: 0.04, 1950: 0.00, 1951: -0.02, 1952: 0.02, 1953: 0.02,
                    1954: 0.03, 1955: -0.01, 1956: -0.02, 1957: 0.06, 1958: -0.02, 1959: -0.02,
                    1960: 0.12, 1961: 0.02, 1962: 0.05, 1963: 0.02, 1964: 0.04, 1965: 0.00,
                    1966: 0.02, 1967: -0.02, 1968: 0.03, 1969: -0.05, 1970: 0.16, 1971: 0.09,
                    1972: 0.02, 1973: 0.03, 1974: 0.02, 1975: 0.04, 1976: 0.12, 1977: 0.00,
                    1978: -0.01, 1979: 0.00, 1980: -0.04, 1981: 0.02, 1982: 0.32, 1983: 0.01,
                    1984: 0.14, 1985: 0.21, 1986: 0.15, 1987: -0.03, 1988: 0.06, 1989: 0.14,
                    1990: 0.08, 1991: 0.15, 1992: 0.07, 1993: 0.11, 1994: -0.08, 1995: 0.19,
                    1996: 0.01, 1997: 0.10, 1998: 0.09, 1999: -0.08, 2000: 0.15, 2001: 0.05,
                    2002: 0.13, 2003: 0.01, 2004: 0.03, 2005: 0.01, 2006: 0.02, 2007: 0.10,
                    2008: 0.14, 2009: -0.10, 2010: 0.08, 2011: 0.16, 2012: 0.03, 2013: -0.09,
                    2014: 0.10, 2015: 0.01, 2016: 0.01, 2017: 0.02, 2018: -0.01, 2019: 0.09,
                    2020: 0.11, 2021: -0.05, 2022: -0.13, 2023: 0.00, 2024: 0.04
                }
            },
            nikkei: {
                name: 'Êó•ÁµåÂπ≥Âùá',
                color: '#4BC0C0',
                avgReturn: 0.0735, // Âπ¥Âπ≥Âùá7.35%
                annualReturns: {
                    1949: 0.02, 1950: 0.30, 1951: 0.41, 1952: 0.38, 1953: 0.02, 1954: 0.05,
                    1955: 0.15, 1956: 0.15, 1957: -0.10, 1958: 0.29, 1959: 0.52, 1960: 0.27,
                    1961: 0.05, 1962: -0.05, 1963: 0.05, 1964: -0.03, 1965: -0.09, 1966: -0.08,
                    1967: 0.26, 1968: 0.39, 1969: 0.13, 1970: -0.18, 1971: 0.29, 1972: 0.92,
                    1973: -0.17, 1974: -0.11, 1975: 0.15, 1976: 0.13, 1977: 0.03, 1978: 0.23,
                    1979: 0.09, 1980: 0.08, 1981: 0.08, 1982: 0.04, 1983: 0.23, 1984: 0.17,
                    1985: 0.13, 1986: 0.43, 1987: 0.15, 1988: 0.40, 1989: 0.29, 1990: -0.38,
                    1991: -0.04, 1992: -0.27, 1993: 0.03, 1994: 0.13, 1995: 0.01, 1996: -0.03,
                    1997: -0.21, 1998: -0.09, 1999: 0.37, 2000: -0.27, 2001: -0.24, 2002: -0.18,
                    2003: 0.24, 2004: 0.08, 2005: 0.40, 2006: 0.06, 2007: -0.11, 2008: -0.42,
                    2009: 0.19, 2010: -0.03, 2011: -0.17, 2012: 0.23, 2013: 0.57, 2014: 0.07,
                    2015: 0.09, 2016: 0.00, 2017: 0.19, 2018: -0.12, 2019: 0.18, 2020: 0.16,
                    2021: 0.05, 2022: -0.09, 2023: 0.28, 2024: 0.19
                }
            },
            dollar: {
                name: 'Á±≥„Éâ„É´ÊåáÊï∞',
                color: '#9966FF',
                avgReturn: -0.0006, // Âπ¥Âπ≥Âùá-0.06%
                annualReturns: {
                    1973: 0.00, 1974: -0.04, 1975: 0.07, 1976: 0.08, 1977: -0.08, 1978: -0.12,
                    1979: -0.03, 1980: 0.13, 1981: 0.21, 1982: 0.13, 1983: 0.05, 1984: 0.10,
                    1985: -0.05, 1986: -0.19, 1987: -0.14, 1988: 0.08, 1989: 0.01, 1990: -0.07,
                    1991: -0.02, 1992: 0.07, 1993: 0.06, 1994: -0.05, 1995: -0.04, 1996: 0.08,
                    1997: 0.10, 1998: 0.07, 1999: 0.01, 2000: 0.06, 2001: 0.07, 2002: -0.13,
                    2003: -0.15, 2004: -0.07, 2005: 0.03, 2006: -0.08, 2007: -0.08, 2008: 0.06,
                    2009: -0.05, 2010: 0.01, 2011: 0.01, 2012: -0.01, 2013: 0.00, 2014: 0.12,
                    2015: 0.09, 2016: 0.03, 2017: -0.10, 2018: 0.04, 2019: 0.02, 2020: -0.07,
                    2021: 0.06, 2022: 0.08, 2023: -0.02, 2024: -0.03
                }
            },
            nasdaq: {
                name: 'NASDAQ 100',
                color: '#FF9F40',
                avgReturn: 0.1440, // Âπ¥Âπ≥Âùá14.4%
                annualReturns: {
                    1985: 0.00, 1986: 0.07, 1987: 0.02, 1988: 0.15, 1989: 0.20, 1990: -0.08,
                    1991: 0.57, 1992: 0.04, 1993: 0.15, 1994: -0.03, 1995: 0.43, 1996: 0.43,
                    1997: 0.21, 1998: 0.86, 1999: 1.02, 2000: -0.36, 2001: -0.33, 2002: -0.37,
                    2003: 0.50, 2004: 0.11, 2005: 0.02, 2006: 0.07, 2007: 0.19, 2008: -0.42,
                    2009: 0.55, 2010: 0.20, 2011: 0.03, 2012: 0.18, 2013: 0.37, 2014: 0.19,
                    2015: 0.10, 2016: 0.07, 2017: 0.33, 2018: 0.00, 2019: 0.39, 2020: 0.49,
                    2021: 0.28, 2022: -0.32, 2023: 0.55, 2024: 0.26
                }
            },
            bitcoin: {
                name: '„Éì„ÉÉ„Éà„Ç≥„Ç§„É≥',
                color: '#F7931A',
                avgReturn: 2.30, // Âπ¥Âπ≥Âùá230%
                annualReturns: {
                    2010: 0.00, 2011: 15.00, 2012: 1.86, 2013: 55.00, 2014: -0.58, 2015: 0.35,
                    2016: 1.25, 2017: 13.80, 2018: -0.73, 2019: 0.95, 2020: 3.01, 2021: 0.60,
                    2022: -0.64, 2023: 1.56, 2024: 0.62
                }
            },
            jpy: {
                name: 'Êó•Êú¨ÂÜÜ',
                color: '#E91E63',
                avgReturn: -0.0053, // Âπ¥Âπ≥Âùá-0.53%
                annualReturns: {
                    1949: 0.00, 1950: 0.00, 1951: -0.01, 1952: 0.00, 1953: 0.00, 1954: 0.00,
                    1955: 0.00, 1956: -0.01, 1957: 0.00, 1958: 0.00, 1959: 0.00, 1960: -0.01,
                    1961: 0.00, 1962: 0.00, 1963: 0.00, 1964: 0.00, 1965: 0.00, 1966: -0.01,
                    1967: 0.00, 1968: 0.00, 1969: 0.00, 1970: -0.02, 1971: 0.07, 1972: 0.05,
                    1973: 0.28, 1974: 0.08, 1975: 0.01, 1976: 0.11, 1977: 0.11, 1978: 0.28,
                    1979: -0.08, 1980: -0.07, 1981: 0.09, 1982: 0.05, 1983: 0.05, 1984: 0.06,
                    1985: 0.14, 1986: 0.23, 1987: 0.19, 1988: 0.09, 1989: -0.11, 1990: -0.08,
                    1991: 0.04, 1992: 0.06, 1993: 0.13, 1994: 0.10, 1995: 0.06, 1996: -0.06,
                    1997: 0.06, 1998: 0.02, 1999: 0.03, 2000: 0.04, 2001: 0.05, 2002: 0.03,
                    2003: -0.01, 2004: 0.03, 2005: 0.09, 2006: 0.03, 2007: 0.06, 2008: -0.18,
                    2009: 0.07, 2010: 0.05, 2011: 0.06, 2012: 0.14, 2013: -0.17, 2014: -0.12,
                    2015: -0.09, 2016: 0.03, 2017: 0.04, 2018: 0.03, 2019: 0.01, 2020: 0.05,
                    2021: -0.09, 2022: -0.19, 2023: -0.07, 2024: 0.10
                }
            }
        };

        // Initialize window.simChart to null to prevent conflicts
        window.simChart = null;

        function runSimulation() {
            const asset = document.getElementById('assetSelect').value;
            const startYear = parseInt(document.getElementById('simStartYear').value);
            const endYear = parseInt(document.getElementById('simEndYear').value);

            if (startYear >= endYear) {
                alert('ÁµÇ‰∫ÜÂπ¥„ÅØÈñãÂßãÂπ¥„Çà„ÇäÂæå„Å´Ë®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            const assetInfo = simulatorData[asset];
            if (!assetInfo) {
                alert('Ë≥áÁî£„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }

            let currentValue = 1000000;
            const historicalValues = [];
            const projectedValues = [];
            const historicalYears = [];
            const projectedYears = [];
            let totalYears = 0;
            let lastHistoricalYear = Math.max(...Object.keys(assetInfo.annualReturns).map(Number));

            // ÈñãÂßãÂπ¥„ÅÆÂÄ§„ÇíËøΩÂä†
            if (startYear <= lastHistoricalYear) {
                historicalValues.push(1000000);
                historicalYears.push(startYear);
            } else {
                projectedValues.push(1000000);
                projectedYears.push(startYear);
            }

            for (let year = startYear; year < endYear; year++) {
                totalYears++;
                // ÈÅéÂéª„Éá„Éº„Çø„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØÂÆüÈöõ„ÅÆ„É™„Çø„Éº„É≥„Çí‰ΩøÁî®
                if (assetInfo.annualReturns[year] !== undefined) {
                    currentValue *= (1 + assetInfo.annualReturns[year]);
                    historicalValues.push(currentValue);
                    historicalYears.push(year + 1);
                } else {
                    // Êú™Êù•‰∫àÊ∏¨„ÅØÂπ≥Âùá„É™„Çø„Éº„É≥„Çí‰ΩøÁî®
                    currentValue *= (1 + assetInfo.avgReturn);
                    projectedValues.push(currentValue);
                    projectedYears.push(year + 1);
                }
            }

            if (totalYears === 0) {
                alert('ÈÅ∏Êäû„Åó„ÅüÊúüÈñì„ÅåÁÑ°Âäπ„Åß„Åô');
                return;
            }

            const totalReturn = ((currentValue - 1000000) / 1000000) * 100;
            const annualReturn = (Math.pow(currentValue / 1000000, 1 / totalYears) - 1) * 100;

            // Display results
            document.getElementById('simulationResult').style.display = 'block';
            document.getElementById('resultTitle').textContent = `${assetInfo.name} (${startYear}Âπ¥„Äú${endYear}Âπ¥)`;
            document.getElementById('finalValue').textContent = '¬•' + Math.round(currentValue).toLocaleString();

            const totalReturnEl = document.getElementById('totalReturn');
            totalReturnEl.textContent = (totalReturn >= 0 ? '+' : '') + totalReturn.toFixed(1) + '%';
            totalReturnEl.style.color = totalReturn >= 0 ? '#28a745' : '#dc3545';

            const annualReturnEl = document.getElementById('annualReturn');
            annualReturnEl.textContent = (annualReturn >= 0 ? '+' : '') + annualReturn.toFixed(2) + '%';
            annualReturnEl.style.color = annualReturn >= 0 ? '#28a745' : '#dc3545';

            // Draw chart with proper cleanup and initialization
            setTimeout(() => {
                const canvas = document.getElementById('simChart');
                if (!canvas) {
                    console.error('Canvas element not found');
                    return;
                }

                const ctx = canvas.getContext('2d');

                // Destroy existing chart if it exists
                if (window.simChart && typeof window.simChart.destroy === 'function') {
                    window.simChart.destroy();
                    window.simChart = null;
                }

                // ÈÅéÂéª„Å®Êú™Êù•„ÅÆ„Éá„Éº„Çø„Çª„ÉÉ„Éà„ÇíÊ∫ñÂÇô
                const datasets = [];

                // ÈÅéÂéª„Éá„Éº„ÇøÔºàÂÆüÁ∑öÔºâ
                if (historicalValues.length > 0) {
                    datasets.push({
                        label: assetInfo.name + ' (ÂÆüÁ∏æ)',
                        data: historicalYears.map((year, i) => ({x: year, y: historicalValues[i]})),
                        borderColor: assetInfo.color,
                        backgroundColor: assetInfo.color + '20',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 2
                    });
                }

                // Êú™Êù•‰∫àÊ∏¨ÔºàÁÇπÁ∑öÔºâ
                if (projectedValues.length > 0) {
                    // ÈÅéÂéª„Å®Êú™Êù•„ÅÆÊé•Á∂ö„Éù„Ç§„É≥„Éà„ÇíËøΩÂä†
                    const connectionData = [];
                    if (historicalValues.length > 0) {
                        connectionData.push({
                            x: historicalYears[historicalYears.length - 1],
                            y: historicalValues[historicalValues.length - 1]
                        });
                    }
                    projectedYears.forEach((year, i) => {
                        connectionData.push({x: year, y: projectedValues[i]});
                    });

                    datasets.push({
                        label: assetInfo.name + ' (‰∫àÊ∏¨)',
                        data: connectionData,
                        borderColor: assetInfo.color,
                        backgroundColor: assetInfo.color + '10',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        tension: 0.4,
                        fill: true,
                        pointRadius: 2
                    });
                }

                // Create new chart
                window.simChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return '¬•' + Math.round(context.raw).toLocaleString();
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                type: 'linear',
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    stepSize: 5,
                                    callback: function(value) {
                                        return Math.round(value);
                                    }
                                }
                            },
                            y: {
                                ticks: {
                                    callback: function(value) {
                                        if (value >= 1000000) {
                                            return '¬•' + (value / 1000000).toFixed(1) + 'M';
                                        } else {
                                            return '¬•' + (value / 1000).toFixed(0) + 'K';
                                        }
                                    }
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                }
                            }
                        }
                    }
                });
            }, 100);
        }

        // Period filter function
        let currentPeriod = 100; // „Éá„Éï„Ç©„É´„Éà„ÅØ100Âπ¥

        function changePeriod(years) {
            currentPeriod = years;

            // „Éú„Çø„É≥„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // „ÉÅ„É£„Éº„Éà„Ç≥„É≥„ÉÜ„Éä„ÅÆÈ´ò„Åï„ÇíË™øÊï¥Ôºà10Âπ¥‰ª•‰∏ã„ÅÆÁü≠ÊúüÈñì„ÅØÈ´ò„Åè„Åô„ÇãÔºâ
            const chartContainer = document.querySelector('.chart-container');
            if (years <= 10) {
                chartContainer.classList.add('short-period');
            } else {
                chartContainer.classList.remove('short-period');
            }

            // „Éá„Éº„Çø„Çí„Éï„Ç£„É´„Çø„Éº
            const currentYear = 2024;
            const startYear = currentYear - years;

            const filteredData = dataPoints.filter(d => d.year >= startYear);

            // ÈñãÂßãÂπ¥„ÅÆÂêÑË≥áÁî£„ÅÆÂÄ§„ÇíÂèñÂæóÔºàÊ≠£Ë¶èÂåñ„ÅÆÂü∫Ê∫ñÔºâ
            const startValues = filteredData[0];

            // „ÉÅ„É£„Éº„Éà„ÅÆ„É©„Éô„É´„Å®„Éá„Éº„Çø„ÇíÊõ¥Êñ∞
            mainChart.data.labels = filteredData.map(d => d.year);

            // Ê≠£Ë¶èÂåñ„Åï„Çå„Åü„Éá„Éº„Çø„ÇíÂèéÈõÜ
            const allNormalizedValues = [];

            // ÂêÑ„Éá„Éº„Çø„Çª„ÉÉ„Éà„ÅÆ„Éá„Éº„Çø„ÇíÊõ¥Êñ∞ÔºàÈñãÂßãÊôÇÁÇπ„Çí100‰∏áÂÜÜ„Å´Ê≠£Ë¶èÂåñÔºâ
            Object.keys(allDatasets).forEach(key => {
                const dataset = allDatasets[key];

                // ÈñãÂßãÊôÇÁÇπ„ÅÆÂÄ§„ÅßÊ≠£Ë¶èÂåñ„Åó„Å¶100‰∏áÂÜÜÂü∫Ê∫ñ„Å´
                let normalizedValues;
                if (startValues[key] !== null && startValues[key] !== undefined) {
                    normalizedValues = filteredData.map(d => {
                        if (d[key] === null || d[key] === undefined) return null;
                        return (d[key] / startValues[key]) * 1000000;
                    });
                    // null‰ª•Â§ñ„ÅÆÂÄ§„ÇíÂèéÈõÜ
                    allNormalizedValues.push(...normalizedValues.filter(v => v !== null));
                } else {
                    normalizedValues = filteredData.map(d => d[key]);
                }

                // „ÉÅ„É£„Éº„ÉàÂÜÖ„ÅÆÂØæÂøú„Åô„Çã„Éá„Éº„Çø„Çª„ÉÉ„Éà„ÇíË¶ã„Å§„Åë„Å¶Êõ¥Êñ∞
                const chartDataset = mainChart.data.datasets.find(ds => ds.label === dataset.label);
                if (chartDataset) {
                    chartDataset.data = normalizedValues;
                }
            });

            // 10Âπ¥‰ª•‰∏ã„ÅÆÁü≠ÊúüÈñì„ÅØÁ∑öÂΩ¢„Çπ„Ç±„Éº„É´„ÄÅ„Åù„Çå‰ª•‰∏ä„ÅØÂØæÊï∞„Çπ„Ç±„Éº„É´„Å´Âàá„ÇäÊõø„Åà
            if (years <= 10) {
                mainChart.options.scales.y.type = 'linear';
            } else {
                mainChart.options.scales.y.type = 'logarithmic';
            }

            // YËª∏„ÅÆÁØÑÂõ≤„ÇíÂãïÁöÑ„Å´Ë™øÊï¥
            if (allNormalizedValues.length > 0) {
                const minValue = Math.min(...allNormalizedValues);
                const maxValue = Math.max(...allNormalizedValues);

                let yMin, yMax;

                // Áü≠ÊúüÈñì„ÅØÂõ∫ÂÆö„ÅÆ‰∏äÈôêÂÄ§„Çí‰ΩøÁî®
                if (currentPeriod <= 1) {
                    yMax = 3000000; // 1Âπ¥: 300‰∏áÂÜÜ
                    yMin = Math.min(minValue * 0.98, 700000); // ÊúÄÂ∞èÂÄ§„ÅÆ2%‰∏ã„Åæ„Åü„ÅØ70‰∏áÂÜÜ
                } else if (currentPeriod <= 5) {
                    yMax = 5000000; // 5Âπ¥: 500‰∏áÂÜÜ
                    yMin = Math.min(minValue * 0.97, 500000); // ÊúÄÂ∞èÂÄ§„ÅÆ3%‰∏ã„Åæ„Åü„ÅØ50‰∏áÂÜÜ
                } else if (currentPeriod <= 10) {
                    yMax = 10000000; // 10Âπ¥: 1000‰∏áÂÜÜ
                    yMin = Math.min(minValue * 0.96, 400000); // ÊúÄÂ∞èÂÄ§„ÅÆ4%‰∏ã„Åæ„Åü„ÅØ40‰∏áÂÜÜ
                } else {
                    // 20Âπ¥‰ª•‰∏ä„ÅØÂãïÁöÑË™øÊï¥
                    const marginRatio = 0.1;
                    const range = maxValue - minValue;
                    yMin = minValue - (range * marginRatio);
                    yMax = maxValue + (range * marginRatio);
                }

                mainChart.options.scales.y.min = yMin;
                mainChart.options.scales.y.max = yMax;
            }

            mainChart.update();
        }

        // Function to update chart based on checkbox selections
        function updateChart() {
            const selectedAssets = [];
            const checkboxes = [
                { id: 'chart-sp500', key: 'sp500' },
                { id: 'chart-gold', key: 'gold' },
                { id: 'chart-bonds', key: 'bonds' },
                { id: 'chart-nikkei', key: 'nikkei' },
                { id: 'chart-dollar', key: 'dollar' },
                { id: 'chart-nasdaq', key: 'nasdaq' },
                { id: 'chart-bitcoin', key: 'bitcoin' },
                { id: 'chart-jpy', key: 'jpy' }
            ];

            // ÁèæÂú®„ÅÆÊúüÈñì„Åß„Éï„Ç£„É´„Çø„Éº„Åï„Çå„Åü„Éá„Éº„Çø„Çí‰ΩøÁî®
            const currentYear = 2024;
            const startYear = currentYear - currentPeriod;
            const filteredData = dataPoints.filter(d => d.year >= startYear);

            // ÈñãÂßãÂπ¥„ÅÆÂÄ§„ÇíÂèñÂæóÔºàÊ≠£Ë¶èÂåñ„ÅÆÂü∫Ê∫ñÔºâ
            const startValues = filteredData[0];

            // Ê≠£Ë¶èÂåñ„Åï„Çå„Åü„Éá„Éº„Çø„ÇíÂèéÈõÜ
            const allNormalizedValues = [];

            checkboxes.forEach(checkbox => {
                if (document.getElementById(checkbox.id).checked) {
                    const key = checkbox.key;
                    const dataset = {...allDatasets[key]};

                    // ÈñãÂßãÊôÇÁÇπ„ÅÆÂÄ§„ÅßÊ≠£Ë¶èÂåñ„Åó„Å¶100‰∏áÂÜÜÂü∫Ê∫ñ„Å´
                    if (startValues[key] !== null && startValues[key] !== undefined) {
                        dataset.data = filteredData.map(d => {
                            if (d[key] === null || d[key] === undefined) return null;
                            return (d[key] / startValues[key]) * 1000000;
                        });
                        // null‰ª•Â§ñ„ÅÆÂÄ§„ÇíÂèéÈõÜ
                        allNormalizedValues.push(...dataset.data.filter(v => v !== null));
                    } else {
                        dataset.data = filteredData.map(d => d[key]);
                    }

                    selectedAssets.push(dataset);
                }
            });

            // Update chart data
            mainChart.data.labels = filteredData.map(d => d.year);
            mainChart.data.datasets = selectedAssets;

            // 10Âπ¥‰ª•‰∏ã„ÅÆÁü≠ÊúüÈñì„ÅØÁ∑öÂΩ¢„Çπ„Ç±„Éº„É´„ÄÅ„Åù„Çå‰ª•‰∏ä„ÅØÂØæÊï∞„Çπ„Ç±„Éº„É´„Å´Âàá„ÇäÊõø„Åà
            if (currentPeriod <= 10) {
                mainChart.options.scales.y.type = 'linear';
            } else {
                mainChart.options.scales.y.type = 'logarithmic';
            }

            // YËª∏„ÅÆÁØÑÂõ≤„ÇíÂãïÁöÑ„Å´Ë™øÊï¥
            if (allNormalizedValues.length > 0) {
                const minValue = Math.min(...allNormalizedValues);
                const maxValue = Math.max(...allNormalizedValues);

                let yMin, yMax;

                // Áü≠ÊúüÈñì„ÅØÂõ∫ÂÆö„ÅÆ‰∏äÈôêÂÄ§„Çí‰ΩøÁî®
                if (currentPeriod <= 1) {
                    yMax = 3000000; // 1Âπ¥: 300‰∏áÂÜÜ
                    yMin = Math.min(minValue * 0.98, 700000); // ÊúÄÂ∞èÂÄ§„ÅÆ2%‰∏ã„Åæ„Åü„ÅØ70‰∏áÂÜÜ
                } else if (currentPeriod <= 5) {
                    yMax = 5000000; // 5Âπ¥: 500‰∏áÂÜÜ
                    yMin = Math.min(minValue * 0.97, 500000); // ÊúÄÂ∞èÂÄ§„ÅÆ3%‰∏ã„Åæ„Åü„ÅØ50‰∏áÂÜÜ
                } else if (currentPeriod <= 10) {
                    yMax = 10000000; // 10Âπ¥: 1000‰∏áÂÜÜ
                    yMin = Math.min(minValue * 0.96, 400000); // ÊúÄÂ∞èÂÄ§„ÅÆ4%‰∏ã„Åæ„Åü„ÅØ40‰∏áÂÜÜ
                } else {
                    // 20Âπ¥‰ª•‰∏ä„ÅØÂãïÁöÑË™øÊï¥
                    const marginRatio = 0.1;
                    const range = maxValue - minValue;
                    yMin = minValue - (range * marginRatio);
                    yMax = maxValue + (range * marginRatio);
                }

                mainChart.options.scales.y.min = yMin;
                mainChart.options.scales.y.max = yMax;
            }

            mainChart.update();
        }

        // „Ç∑„Éü„É•„É¨„Éº„Çø„Éº„ÉÅ„É£„Éº„ÉàÂ§ñ„Çø„ÉÉ„ÉóÊôÇ„Å´„ÉÑ„Éº„É´„ÉÅ„ÉÉ„Éó„ÇíÈùûË°®Á§∫
        document.addEventListener('click', function(e) {
            const simCanvas = document.getElementById('simulationChart');
            if (window.simChart && simCanvas && !simCanvas.contains(e.target)) {
                window.simChart.tooltip.setActiveElements([], {x: 0, y: 0});
                window.simChart.update();
            }
        });

        // Initialize main chart on page load
        window.addEventListener('DOMContentLoaded', (event) => {
            initChart();
            // ÂàùÊúüË°®Á§∫ÊôÇ„Å´YËª∏ÁØÑÂõ≤„ÇíË®≠ÂÆö
            updateChart();
        });
    </script>
</body>
</html>